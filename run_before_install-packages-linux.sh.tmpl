{{- if eq .chezmoi.os "linux" -}}
#!/usr/bin/env bash

ARCH=$(uname -m)
ARCH_BIN="${HOME}/.local/${ARCH}/bin"
mkdir -p "${ARCH_BIN}"

# Ensure large install directory is writable
if [[ ! -d "{{ .large_install_dir }}/.local/${ARCH}" ]]; then
    if ! mkdir -p "{{ .large_install_dir }}/.local/${ARCH}" 2>/dev/null; then
        echo "ERROR: Cannot create {{ .large_install_dir }}/.local/${ARCH}"
        echo "Check that the install directory is accessible"
        exit 1
    fi
fi

export PYENV_ROOT="{{ .large_install_dir }}/.local/${ARCH}/pyenv"
if [[ ! -x "$(command -v pyenv)" ]] && [[ ! -d "${PYENV_ROOT}" ]]; then
   curl https://pyenv.run | bash
fi

if [[ ! -x "${ARCH_BIN}/fzf" ]]; then
   if [[ ! -d "$HOME/.fzf" ]]; then
       git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf
   fi
   ~/.fzf/install --all --bin
   [[ -f ~/.fzf/bin/fzf ]] && mv ~/.fzf/bin/fzf "${ARCH_BIN}/"
   [[ -f ~/.fzf/bin/fzf-tmux ]] && mv ~/.fzf/bin/fzf-tmux "${ARCH_BIN}/"
fi

if [[ ! -x "${ARCH_BIN}/uv" ]]; then
   curl -LsSf https://astral.sh/uv/install.sh | sh
   [[ -f "${HOME}/.local/bin/uv" ]] && mv "${HOME}/.local/bin/uv" "${ARCH_BIN}/"
   [[ -f "${HOME}/.local/bin/uvx" ]] && mv "${HOME}/.local/bin/uvx" "${ARCH_BIN}/"
fi

{{ end -}}
